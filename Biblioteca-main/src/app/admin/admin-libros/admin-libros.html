<div class="admin-libros">
  <header class="header">
    <h2>Gestión de libros</h2>
    <p>Agrega nuevos títulos al catálogo o incrementa el stock de libros existentes.</p>
  </header>

  <section class="feedback" *ngIf="errorMessage() || successMessage()">
    <div class="alert error" *ngIf="errorMessage()">{{ errorMessage() }}</div>
    <div class="alert success" *ngIf="successMessage()">{{ successMessage() }}</div>
  </section>

  <section class="panel">
    <div class="card">
      <h3>Registrar nuevo libro</h3>
      <form [formGroup]="crearLibroForm" (ngSubmit)="crearLibro()" novalidate>
        <div class="grid">
          <label>
            Título
            <input type="text" formControlName="titulo" placeholder="Ej. Cien años de soledad">
            <span class="error" *ngIf="crearLibroForm.controls.titulo.invalid && crearLibroForm.controls.titulo.touched">
              El título es obligatorio.
            </span>
          </label>

          <label>
            Autor
            <input type="text" formControlName="autor" placeholder="Ej. Gabriel García Márquez">
            <span class="error" *ngIf="crearLibroForm.controls.autor.invalid && crearLibroForm.controls.autor.touched">
              El autor es obligatorio.
            </span>
          </label>

          <label>
            Género
            <input type="text" formControlName="genero" placeholder="Ej. Novela">
            <span class="error" *ngIf="crearLibroForm.controls.genero.invalid && crearLibroForm.controls.genero.touched">
              El género es obligatorio.
            </span>
          </label>

          <label>
            Año de edición
            <input type="text" formControlName="anio_edicion" placeholder="Ej. 1967">
            <span class="error" *ngIf="crearLibroForm.controls.anio_edicion.invalid && crearLibroForm.controls.anio_edicion.touched">
              El año de edición es obligatorio.
            </span>
          </label>

          <label class="full-row">
            Descripción
            <textarea formControlName="descripcion" rows="3" placeholder="Breve reseña del libro"></textarea>
            <span class="error" *ngIf="crearLibroForm.controls.descripcion.invalid && crearLibroForm.controls.descripcion.touched">
              La descripción es obligatoria.
            </span>
          </label>

          <label>
            Copias totales
            <input type="number" min="0" formControlName="copias_totales">
          </label>

          <label>
            URL de la portada (opcional)
            <input type="url" formControlName="imagen" placeholder="https://...">
          </label>
        </div>

        <div class="actions">
          <button type="submit" [disabled]="isProcessing()">Guardar libro</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h3>Añadir existencias</h3>
      <form [formGroup]="stockForm" (ngSubmit)="agregarStock()" novalidate>
        <div class="grid">
          <label>
            Libro
            <select formControlName="libroId">
              <option value="" disabled>Selecciona un libro</option>
              <option *ngFor="let libro of libros()" [value]="libro._id">
                {{ libro.titulo }} (Disponibles: {{ libro.copias_disponibles }})
              </option>
            </select>
          </label>

          <label>
            Cantidad a añadir
            <input type="number" min="1" formControlName="cantidad">
          </label>
        </div>

        <div class="actions">
          <button type="submit" [disabled]="isProcessing()">Actualizar stock</button>
        </div>
      </form>
    </div>
  </section>

  <section class="tabla-libros">
    <h3>Catálogo actual</h3>

    <div class="alert info" *ngIf="isFetching()">Cargando libros...</div>

    <div class="tabla-wrapper">
      <table>
        <thead>
          <tr>
            <th>Título</th>
            <th>Autor</th>
            <th>Género</th>
            <th>Disponibles</th>
            <th>Totales</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let libro of libros()">
            <td>{{ libro.titulo }}</td>
            <td>{{ libro.autor }}</td>
            <td>{{ libro.genero }}</td>
            <td>{{ libro.copias_disponibles }}</td>
            <td>{{ libro.copias_totales }}</td>
            <td>
              <span class="badge" [class.disponible]="libro.disponibilidad === 'Disponible'" [class.agotado]="libro.disponibilidad === 'Agotado'">
                {{ libro.disponibilidad }}
              </span>
            </td>
            <td class="acciones">
              <button class="btn btn-danger" type="button" (click)="eliminarLibro(libro)" [disabled]="isProcessing()">
                Eliminar
              </button>
            </td>
          </tr>
          <tr *ngIf="!isFetching() && libros().length === 0">
            <td colspan="7" class="empty">No hay libros registrados todavía.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

